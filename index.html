<!DOCTYPE html>
<html>
  <style>
    text {
      font: 10px sans-serif;
    }
  </style>
  <body>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script>
      var data = [
        { patient: "John Rivers", area: "Neonatal Intensive Care Unit", doctor: "Dr. Shapiro", violation: "violation 1" },
        { patient: "John Rivers", area: "Neonatal Intensive Care Unit", doctor: "Dr. Shapiro", violation: "violation 2" },
        { patient: "John Rivers", area: "Neonatal Intensive Care Unit", doctor: "Dr. Shapiro", violation: "violation 3" },
        { patient: "John Rivers", area: "Neonatal Intensive Care Unit", doctor: "Dr. Shapiro", violation: "violation 4" },
        { patient: "John Rivers", area: "Intensive Care Unit", doctor: "Dr. Marcus Layre", violation: "violation 1" },
        { patient: "John Rivers", area: "Intensive Care Unit", doctor: "Dr. Marcus Layre", violation: "violation 2" }
      ];

      var convertedData = {
        name: "John Rivers",
        areas: [
          {
            name: "Neonatal Intensive Care Unit",
            doctors: [
              {
                name: "Dr. Shapiro",
                violations: [
                  "Violation 1", "Violation 2", "Violation 3"
                ]
              },
              {
                name: "Dr. Erin McPersson",
                violations: [
                  "Violation 1", "Violation 2", "Violation 3", "Violation 4"
                ]
              }
            ]
          },
          {
            name: "Intensive Care Unit",
            doctors: [
              {
                name: "Dr. Marcus Layre",
                violations: [
                  "Violation 1", "Violation 2"
                ]
              }
            ]
          },
          {
            name: "Ambulatory",
            doctors: [
              {
                name: "Dr. Peter Veickman",
                violations: [
                  "Violation 1", "Violation 2"
                ]
              },
              {
                name: "Dr. Andrew Leehman",
                violations: [
                  "Violation 1", "Violation 2", "Violation 3"
                ]
              }
            ]
          }
        ]
      };

      var width = 960,
          height = 500;

      var circleSizeScale = d3.scale.linear().domain([0,7]).range([0,25]);

      var svgContainer = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

      var node = svgContainer.selectAll(".node")
        .data(convertedData.areas)
        .enter()
        .append("g")
        .attr("transform", function(d, i) { return "translate(0," + (i * 50) + ")"; });

      node.append("circle")
        .attr("cx", 25)
        .attr("cy", 25)
        .attr("r", function(d) {
          var violations = d.doctors
            .map(function(d) { return d.violations.length; })
            .reduce(function(p, c, i, array) { return p + c });
          console.log("violations", violations);
          return circleSizeScale(violations);
        })
        .style("fill", "green");

      node.append("text")
        .attr("x", 60)
        .attr("y", 25)
        .text(function(d) { return d.name });
    </script>
  </body>
</html>
